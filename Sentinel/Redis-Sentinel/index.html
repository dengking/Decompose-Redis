
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Project documentation with Markdown.">
      
      
      
        <meta name="author" content="DengKing">
      
      
        <link rel="canonical" href="https://dengking.github.io/decompose-redis/Sentinel/Redis-Sentinel/">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.3">
    
    
      
        <title>Redis-Sentinel - decompose-redis</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1655a90d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-27795084-5","mkdocs.org"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#redis#sentinel" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://dengking.github.io/decompose-redis" title="decompose-redis" class="md-header__button md-logo" aria-label="decompose-redis">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            decompose-redis
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Redis-Sentinel
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/dengking/decompose-redis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://dengking.github.io/decompose-redis" title="decompose-redis" class="md-nav__button md-logo" aria-label="decompose-redis">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    decompose-redis
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/dengking/decompose-redis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Books
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Books" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Books
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Books/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Data-structure
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Data-structure" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Data-structure
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      <label class="md-nav__link" for="__nav_3_1">
        Generic-double-linked-list
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Generic-double-linked-list" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Generic-double-linked-list
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Data-structure/Generic-double-linked-list/Generic-double-linked-list/" class="md-nav__link">
        Generic-double-linked-list
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        Rax
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Rax" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Rax
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Data-structure/Rax/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      <label class="md-nav__link" for="__nav_3_3">
        Dict
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Dict" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Dict
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Data-structure/Dict/Dict/" class="md-nav__link">
        Dict
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Data-structure/Dict/Dict-usage/" class="md-nav__link">
        Dict-usage
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Data-structure/Dict/Dncremental-rehash/" class="md-nav__link">
        Dncremental-rehash
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Event-library
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Event-library" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Event-library
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Event-library/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        Sentinel
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Sentinel" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Sentinel
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Redis-Sentinel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Redis-Sentinel
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#redis#sentinel#documentation" class="md-nav__link">
    官方文档Redis Sentinel Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed#nature#of#sentinel" class="md-nav__link">
    Distributed nature of Sentinel
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Command
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Command" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Command
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Command/Commands/" class="md-nav__link">
        Commands
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Clients
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Clients" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Clients
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" >
      
      <label class="md-nav__link" for="__nav_7_1">
        Redis-plus-plus
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Redis-plus-plus" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Redis-plus-plus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Clients/Redis-plus-plus/Redis-plus-plus/" class="md-nav__link">
        Redis-plus-plus
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Redis-cli
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Redis-cli" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Redis-cli
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Redis-cli/Redis-cli/" class="md-nav__link">
        Redis-cli
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2" type="checkbox" id="__nav_8_2" >
      
      <label class="md-nav__link" for="__nav_8_2">
        linenoise
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="linenoise" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_2">
          <span class="md-nav__icon md-icon"></span>
          linenoise
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Redis-cli/linenoise/linenoise/" class="md-nav__link">
        linenoise
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#redis#sentinel#documentation" class="md-nav__link">
    官方文档Redis Sentinel Documentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed#nature#of#sentinel" class="md-nav__link">
    Distributed nature of Sentinel
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="redis#sentinel">Redis sentinel</h1>
<h2 id="redis#sentinel#documentation">官方文档<a href="https://redis.io/topics/sentinel">Redis Sentinel Documentation</a></h2>
<p>Redis Sentinel also provides other collateral（附属的） tasks such as <strong>monitoring</strong>, <strong>notifications</strong> and acts as a <strong>configuration provider</strong> for clients.</p>
<p>This is the full list of Sentinel capabilities at a macroscopical（宏观的） level (i.e. the <em>big picture</em>):</p>
<ul>
<li>
<p><strong>Monitoring</strong>. Sentinel constantly checks if your master and slave instances are working as expected.</p>
</li>
<li>
<p><strong>Notification</strong>. Sentinel can notify the <strong>system administrator</strong>, another computer programs, via an API, that something is wrong with one of the monitored Redis instances.</p>
</li>
<li>
<p><strong>Automatic failover</strong>. If a <strong>master</strong> is not working as expected, Sentinel can start a <strong>failover process</strong> where a slave is promoted to master, the other additional slaves are reconfigured to use the new master, and the applications using the Redis server informed about the new address to use when connecting.</p>
</li>
</ul>
<p>自动故障转移。 如果主服务器未按预期工作，Sentinel可以启动故障转移过程，其中从服务器升级为主服务器，其他其他服务器重新配置为使用新主服务器，并且使用Redis服务器的应用程序通知有关新服务器的地址。连接。</p>
<ul>
<li><strong>Configuration provider</strong>. Sentinel acts as a source of authority for <strong>clients service discovery</strong>: clients connect to <strong>Sentinels</strong> in order to ask for the address of the <strong>current Redis master</strong> responsible for a given service. If a <strong>failover</strong> occurs, <strong>Sentinels</strong> will report the new address.</li>
</ul>
<h2 id="distributed#nature#of#sentinel">Distributed nature of Sentinel</h2>
<p><strong>Redis Sentinel</strong> is a distributed system:</p>
<p><strong>Sentinel</strong> itself is designed to run in a configuration where there are multiple Sentinel processes cooperating together. The advantage of having multiple Sentinel processes cooperating are the following:</p>
<ol>
<li>Failure detection is performed when multiple Sentinels agree about the fact a given master is no longer available. This lowers the probability of <strong>false positives</strong>.</li>
<li><strong>Sentinel</strong> works even if not all the Sentinel processes are working, making the system robust against failures. There is no fun in having a fail over system which is itself a single point of failure, after all.</li>
</ol>
<p>The sum of Sentinels, Redis instances (masters and slaves) and clients connecting to Sentinel and Redis, are also a larger distributed system with specific properties. In this document concepts will be introduced gradually starting from basic information needed in order to understand the basic properties of Sentinel, to more complex information (that are optional) in order to understand how exactly Sentinel works.</p>
<h1 id="quick#start">Quick Start</h1>
<h2 id="obtaining#sentinel">Obtaining Sentinel</h2>
<p>The current version of Sentinel is called <strong>Sentinel 2</strong>. It is a rewrite of the initial Sentinel implementation using stronger and simpler to predict algorithms (that are explained in this documentation).</p>
<p>A stable release of Redis Sentinel is shipped since Redis 2.8.</p>
<p>New developments are performed in the <em>unstable</em> branch, and new features sometimes are back ported into the latest stable branch as soon as they are considered to be stable.</p>
<p>Redis Sentinel version 1, shipped with Redis 2.6, is deprecated and should not be used.</p>
<h2 id="running#sentinel">Running Sentinel</h2>
<p>If you are using the <code>redis-sentinel</code> executable (or if you have a symbolic link with that name to the <code>redis-server</code>executable) you can run Sentinel with the following command line:</p>
<div class="highlight"><pre><span></span><code>redis-sentinel /path/to/sentinel.conf
</code></pre></div>
<p>Otherwise you can use directly the <code>redis-server</code> executable starting it in <strong>Sentinel mode</strong>:</p>
<div class="highlight"><pre><span></span><code>redis-server /path/to/sentinel.conf --sentinel
</code></pre></div>
<p>Both ways work the same.</p>
<p>However <strong>it is mandatory</strong> to use a configuration file when running <strong>Sentinel</strong>, as this file will be used by the system in order to save the <strong>current state</strong> that will be reloaded in case of restarts. Sentinel will simply refuse to start if no configuration file is given or if the configuration file path is not writable.</p>
<p><strong>Sentinels</strong> by default run <strong>listening for connections to TCP port 26379</strong>, so for Sentinels to work, port 26379 of your servers <strong>must be open</strong> to receive connections from the IP addresses of the other <strong>Sentinel instances</strong>. Otherwise Sentinels can't talk and can't agree about what to do, so failover will never be performed.</p>
<h2 id="fundamental#things#to#know#about#sentinel#before#deploying">Fundamental things to know about Sentinel before deploying</h2>
<ol>
<li>You need at least three Sentinel instances for a robust deployment.</li>
<li>The three Sentinel instances should be placed into computers or virtual machines that are believed to fail in an <strong>independent</strong> way. So for example different physical servers or Virtual Machines executed on different availability zones.</li>
<li>Sentinel + Redis distributed system does not guarantee that <strong>acknowledged writes</strong> are retained(保持) during failures, since Redis uses <strong>asynchronous replication</strong>. However there are ways to deploy Sentinel that make the window to lose writes limited to certain moments, while there are other less secure ways to deploy it.</li>
<li>You need Sentinel support in your clients. Popular client libraries have Sentinel support, but not all.</li>
<li>There is no <a href="https://en.wikipedia.org/wiki/High-availability_cluster">HA</a> setup which is safe if you don't test from time to time in development environments, or even better if you can, in production environments, if they work. You may have a misconfiguration that will become apparent only when it's too late (at 3am when your master stops working).</li>
<li><strong>Sentinel, Docker, or other forms of Network Address Translation or Port Mapping should be mixed with care</strong>: Docker performs port remapping, breaking Sentinel auto discovery of other Sentinel processes and the list of slaves for a master. Check the section about Sentinel and Docker later in this document for more information.</li>
</ol>
<h2 id="configuring#sentinel">Configuring Sentinel</h2>
<p>The Redis source distribution contains a file called <code>sentinel.conf</code> that is a self-documented example configuration file you can use to configure Sentinel, however a typical minimal configuration file looks like the following:</p>
<div class="highlight"><pre><span></span><code>sentinel monitor mymaster 127.0.0.1 6379 2
sentinel down-after-milliseconds mymaster 60000
sentinel failover-timeout mymaster 180000
sentinel parallel-syncs mymaster 1

sentinel monitor resque 192.168.1.3 6380 4
sentinel down-after-milliseconds resque 10000
sentinel failover-timeout resque 180000
sentinel parallel-syncs resque 5
</code></pre></div>
<p>You only need to specify the masters to monitor, giving to each separated master (that may have any number of slaves) a different <strong>name</strong>. There is no need to specify <strong>slaves</strong>, which are <strong>auto-discovered</strong>. <strong>Sentinel</strong> will update the configuration automatically with additional information about slaves (in order to retain the information in case of restart). The configuration is also rewritten every time a slave is promoted to master during a failover and every time a new Sentinel is discovered.</p>
<p>The example configuration above, basically monitor two sets of <strong>Redis instances</strong>, each composed of a <strong>master</strong> and an undefined number of slaves. One set of instances is called <code>mymaster</code>, and the other <code>resque</code>.</p>
<p>The meaning of the arguments of <code>sentinel monitor</code> statements is the following:</p>
<div class="highlight"><pre><span></span><code>sentinel monitor &lt;master-group-name&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;
</code></pre></div>
<p>For the sake of clarity, let's check line by line what the configuration options mean:</p>
<p>The first line is used to tell Redis to monitor a master called <em>mymaster</em>, that is at address 127.0.0.1 and port 6379, with a quorum of 2. Everything is pretty obvious but the <strong>quorum</strong> argument:</p>
<ul>
<li>The <strong>quorum</strong> is the number of <strong>Sentinels</strong> that need to agree about the fact the <strong>master</strong> is not reachable, in order for really mark the slave as failing, and eventually start a fail over procedure if possible.</li>
<li>However <strong>the quorum is only used to detect the failure</strong>. In order to actually perform a failover, one of the Sentinels need to be <strong>elected leader</strong> for the failover and be authorized to proceed. This only happens with the vote of the <strong>majority of the Sentinel processes</strong>.</li>
</ul>
<p>So for example if you have 5 Sentinel processes, and the quorum for a given master set to the value of 2, this is what happens:</p>
<ul>
<li>If two Sentinels agree at the same time about the master being unreachable, one of the two will try to start a failover.</li>
<li>If there are at least a total of three Sentinels <strong>reachable</strong>, the failover will be authorized and will actually start.</li>
</ul>
<p>In practical terms this means during failures <strong>Sentinel never starts a failover if the majority of Sentinel processes are unable to talk</strong> (aka no failover in the minority partition).</p>
<p>实际上，这意味着在故障期间，如果大多数Sentinel进程无法通话（在少数分区中也没有故障转移），Sentinel永远不会启动故障转移。</p>
<h2 id="other#sentinel#options">Other Sentinel options</h2>
<p>The other options are almost always in the form:</p>
<div class="highlight"><pre><span></span><code>sentinel &lt;option_name&gt; &lt;master_name&gt; &lt;option_value&gt;
</code></pre></div>
<p>And are used for the following purposes:</p>
<ul>
<li>
<p><code>down-after-milliseconds</code> is the time in milliseconds an instance should not be reachable (either does not reply to our PINGs or it is replying with an error) for a Sentinel starting to think it is down.</p>
</li>
<li>
<p><code>parallel-syncs</code> sets the number of slaves that can be reconfigured to use the new master after a failover at the same time. The lower the number, the more time it will take for the failover process to complete, however if the slaves are configured to serve old data, you may not want all the slaves to re-synchronize with the master at the same time. While the replication process is mostly non blocking for a slave, there is a moment when it stops to load the bulk data from the master. You may want to make sure only one slave at a time is not reachable by setting this option to the value of 1.</p>
</li>
</ul>
<p>parallel-syncs设置可在同一故障转移后重新配置为使用新主服务器的从服务器数。 数字越小，故障转移过程完成所需的时间就越多，但是如果从属服务器配置为提供旧数据，则可能不希望所有从属服务器同时与主服务器重新同步。 虽然复制过程对于从属设备大部分是非阻塞的，但是有一段时间它停止从主设备加载批量数据。 您可能希望通过将此选项设置为值1来确保一次只能访问一个从站。</p>
<p>Additional options are described in the rest of this document and documented in the example <code>sentinel.conf</code> file shipped with the Redis distribution.</p>
<p>All the configuration parameters can be modified at runtime using the <code>SENTINEL SET</code> command. See the <strong>Reconfiguring Sentinel at runtime</strong> section for more information.</p>
<h2 id="example#sentinel#deployments">Example Sentinel deployments</h2>
<p>Now that you know the basic information about Sentinel, you may wonder where you should place your <strong>Sentinel processes</strong>, how much Sentinel processes you need and so forth. This section shows a few example deployments.</p>
<p>We use ASCII art in order to show you configuration examples in a <em>graphical</em> format, this is what the different symbols means:</p>
<div class="highlight"><pre><span></span><code>+--------------------+
| This is a computer |
| or VM that fails   |
| independently. We  |
| call it a &quot;box&quot;    |
+--------------------+
</code></pre></div>
<p>We write inside the boxes what they are running:</p>
<div class="highlight"><pre><span></span><code>+-------------------+
| Redis master M1   |
| Redis Sentinel S1 |
+-------------------+
</code></pre></div>
<p>Different boxes are connected by lines, to show that they are able to talk:</p>
<div class="highlight"><pre><span></span><code>+-------------+               +-------------+
| Sentinel S1 |---------------| Sentinel S2 |
+-------------+               +-------------+
</code></pre></div>
<p>Network partitions are shown as interrupted lines using slashes:</p>
<div class="highlight"><pre><span></span><code>+-------------+                +-------------+
| Sentinel S1 |------ // ------| Sentinel S2 |
+-------------+                +-------------+
</code></pre></div>
<p>Also note that:</p>
<ul>
<li>Masters are called M1, M2, M3, ..., Mn.</li>
<li>Slaves are called R1, R2, R3, ..., Rn (R stands for <em>replica</em>).</li>
<li>Sentinels are called S1, S2, S3, ..., Sn.</li>
<li>Clients are called C1, C2, C3, ..., Cn.</li>
<li>When an instance changes role because of Sentinel actions, we put it inside square brackets, so [M1] means an instance that is now a master because of Sentinel intervention.</li>
</ul>
<h2 id="example#1#just#two#sentinels#dont#do#this">Example 1: just two Sentinels, DON'T DO THIS</h2>
<div class="highlight"><pre><span></span><code>+----+         +----+
| M1 |---------| R1 |
| S1 |         | S2 |
+----+         +----+

Configuration: quorum = 1
</code></pre></div>
<ul>
<li>In this setup, if the master M1 fails, R1 will be promoted since the two Sentinels can reach agreement about the failure (obviously with quorum set to 1) and can also authorize（批准） a failover because the majority is two. So apparently it could superficially work, however check the next points to see why this setup is broken.</li>
<li>If the box where M1 is running stops working, also S1 stops working. The Sentinel running in the other box S2 will not be able to authorize a failover, so the system will become not available.</li>
</ul>
<p>Note that a <strong>majority</strong> is needed in order to order different failovers, and later propagate the latest configuration to all the <strong>Sentinels</strong>. Also note that the ability to failover in a single side of the above setup, without any agreement, would be very dangerous:</p>
<div class="highlight"><pre><span></span><code>+----+           +------+
| M1 |----//-----| [M1] |
| S1 |           | S2   |
+----+           +------+
</code></pre></div>
<p>In the above configuration we created two masters (assuming S2 could failover without authorization) in a perfectly symmetrical way. Clients may write indefinitely to both sides, and there is no way to understand when the partition heals what configuration is the right one, in order to prevent a <em>permanent split brain condition</em>.</p>
<p>在上面的配置中，我们以完全对称的方式创建了两个主服务器（假设S2可以在未经授权的情况下进行故障转移）。 客户端可以无限期地向双方写入，并且无法理解分区何时恢复正确的配置，以防止永久性的裂脑情况。</p>
<p>So please <strong>deploy at least three Sentinels in three different boxes</strong> always.</p>
<h2 id="example#2#basic#setup#with#three#boxes">Example 2: basic setup with three boxes</h2>
<p>This is a very simple setup, that has the advantage to be simple to tune for additional safety. It is based on three boxes, each box running both a Redis process and a Sentinel process.</p>
<div class="highlight"><pre><span></span><code>       +----+
       | M1 |
       | S1 |
       +----+
          |
+----+    |    +----+
| R2 |----+----| R3 |
| S2 |         | S3 |
+----+         +----+

Configuration: quorum = 2
</code></pre></div>
<p>If the master M1 fails, S2 and S3 will agree about the failure and will be able to authorize a failover, making clients able to continue.</p>
<p>In every Sentinel setup, being Redis asynchronously replicated, there is always the risk of losing some write because a given acknowledged write may not be able to reach the slave which is promoted to master. However in the above setup there is an higher risk due to clients partitioned away with an old master, like in the following picture:</p>
<div class="highlight"><pre><span></span><code>         +----+
         | M1 |
         | S1 | &lt;- C1 (writes will be lost)
         +----+
            |
            /
            /
+------+    |    +----+
| [M2] |----+----| R3 |
| S2   |         | S3 |
+------+         +----+
</code></pre></div>
<h1 id="a#quick#tutorial">A quick tutorial</h1>
<h2 id="asking#sentinel#about#the#state#of#a#master">Asking Sentinel about the state of a master</h2>
<h2 id="obtaining#the#address#of#the#current#master">Obtaining the address of the current master</h2>
<h2 id="testing#the#failover">Testing the failover</h2>
<h1 id="sentinel#api">Sentinel API</h1>
<h2 id="sentinel#commands">Sentinel commands</h2>
<h2 id="reconfiguring#sentinel#at#runtime">Reconfiguring Sentinel at Runtime</h2>
<h2 id="adding#or#removing#sentinels">Adding or removing Sentinels</h2>
<h2 id="removing#the#old#master#or#unreachable#slaves">Removing the old master or unreachable slaves</h2>
<h2 id="pubsub#messages">Pub/Sub Messages</h2>
<h2 id="handling#of#-busy#state">Handling of -BUSY state</h2>
<h2 id="slaves#priority">Slaves priority</h2>
<h2 id="sentinel#and#redis#authentication">Sentinel and Redis authentication</h2>
<h2 id="configuring#sentinel#instances#with#authentication">Configuring Sentinel instances with authentication</h2>
<h1 id="more#advanced#concepts">More advanced concepts</h1>
<p>In the following sections we'll cover a few details about how Sentinel work, without to resorting to implementation details and algorithms that will be covered in the final part of this document.</p>
<h2 id="sdown#and#odown#failure#state">SDOWN and ODOWN failure state</h2>
<h2 id="sentinels#and#slaves#auto#discovery">Sentinels and Slaves auto discovery</h2>
<h2 id="sentinel#reconfiguration#of#instances#outside#the#failover#procedure">Sentinel reconfiguration of instances outside the failover procedure</h2>
<h2 id="slave#selection#and#priority">Slave selection and priority</h2>
<h1 id="algorithms#and#internals">Algorithms and internals</h1>
<p>In the following sections we will explore the details of Sentinel behavior. It is not strictly needed for users to be aware of all the details, but a deep understanding of Sentinel may help to deploy and operate Sentinel in a more effective way.</p>
<h2 id="quorum">Quorum</h2>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../../Event-library/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Introduction
            </div>
          </div>
        </a>
      
      
        <a href="../../Command/Commands/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Commands
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.ca5457b8.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>